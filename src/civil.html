
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Parking System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2ecc71;
            --secondary-dark: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
            --text: #2c3e50;
        }
       
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
       
        body {
            background-color: #f5f5f5;
            color: var(--text);
            transition: background-color 0.3s, color 0.3s;
        }
       
        body.dark-mode {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        body.dark-mode .parking-layout,
        body.dark-mode .booking-panel,
        body.dark-mode .modal-content,
        body.dark-mode .auth-box {
            background-color: #2c2c2c;
            color: #ffffff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
        }
       
        header {
            background-color: var(--primary);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }
       
        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
       
        .logo { font-size: 24px; font-weight: bold; display: flex; align-items: center; }
        .logo i { margin-right: 10px; }
       
        nav ul { display: flex; list-style: none; }
        nav ul li { margin-left: 30px; }
        nav ul li a { color: white; text-decoration: none; font-weight: 500; transition: opacity 0.3s; }
        nav ul li a:hover { opacity: 0.8; }
       
        .mobile-menu-btn { display: none; background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        .user-info { background-color: var(--primary-dark); padding: 5px 15px; border-radius: 20px; font-size: 14px; cursor: pointer; white-space: nowrap; }
       
        .toggle-container { display: flex; align-items: center; margin-left: 20px; }
        .toggle-label { margin-right: 10px; font-size: 14px; color: white; }
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }
       
        .main-content { margin-top: 30px; display: grid; grid-template-columns: 3fr 1fr; gap: 30px; }
        .parking-layout { background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
        .layout-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .layout-title { font-size: 22px; font-weight: bold; }
       
        .parking-filters { display: flex; gap: 20px; flex-wrap: wrap; }
        .filter-item { display: flex; align-items: center; font-size: 14px; }
        .filter-item span { display: inline-block; width: 15px; height: 15px; border-radius: 4px; margin-right: 5px; }
        .legend-available { background-color: var(--secondary); }
        .legend-occupied { background-color: var(--danger); }
        .legend-reserved { background-color: var(--warning); }
        .legend-selected { background-color: var(--primary); outline: 2px solid var(--primary-dark); }
        .legend-disabled { background-color: #95a5a6; }
       
        .parking-area { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 30px; overflow-x: auto; padding-bottom: 15px; }
        .entrance { width: 150px; padding: 10px; background-color: var(--dark); color: white; text-align: center; border-radius: 5px; margin-bottom: 20px; transition: all 0.3s ease; }
        .entrance:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); }
       
        .parking-row { display: flex; gap: 15px; margin-bottom: 10px; align-items: center; min-width: max-content; }
        .row-label { width: 30px; text-align: center; font-weight: bold; }
       
        .parking-slot { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; border-radius: 5px; cursor: pointer; font-weight: bold; transition: all 0.3s; position: relative; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
        .parking-slot:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); z-index: 2; }
        .available { background-color: var(--secondary); color: white; }
        .occupied { background-color: var(--danger); color: white; cursor: not-allowed; }
        .reserved { background-color: var(--warning); color: white; cursor: not-allowed; }
        .disabled { background-color: #95a5a6; color: white; cursor: not-allowed; position: relative; }
        .disabled::after { content: "â™¿"; position: absolute; font-size: 24px; }
        .selected { background-color: var(--primary); outline: 3px solid var(--primary-dark); color: white; transform: scale(1.05); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); z-index: 2; }
       
        .slot-type { position: absolute; top: -20px; left: 0; font-size: 11px; color: var(--dark); font-weight: normal; white-space: nowrap; }
        body.dark-mode .slot-type { color: #ffffff; }
       
        .booking-panel { background-color: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
        .panel-title { font-size: 18px; font-weight: bold; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .booking-details { margin-bottom: 25px; }
        .detail-item { margin-bottom: 15px; }
        .detail-label { font-size: 14px; color: #777; margin-bottom: 5px; }
        body.dark-mode .detail-label { color: #bbb; }
        .detail-value { font-weight: 500; font-size: 16px; }
        .detail-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 15px; }
       
        .booking-actions { display: flex; flex-direction: column; gap: 10px; }
        .btn { padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: 500; transition: all 0.3s; display: flex; align-items: center; justify-content: center; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover { background-color: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        .btn-secondary { background-color: var(--light); color: var(--dark); }
        .btn-secondary:hover { background-color: #ddd; transform: translateY(-2px); }
       
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background-color: white; width: 90%; max-width: 500px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); animation: modalFadeIn 0.3s; max-height: 90vh; overflow-y: auto; }
        @keyframes modalFadeIn { from { opacity: 0; transform: translateY(-50px); } to { opacity: 1; transform: translateY(0); } }
        .modal-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background-color: inherit; z-index: 5; }
        .modal-close { font-size: 24px; cursor: pointer; color: #777; transition: all 0.2s; }
        .modal-close:hover { color: var(--danger); transform: scale(1.1); }
        .modal-body { padding: 20px; }
        .modal-footer { padding: 15px 20px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px; }
       
        .alert { padding: 15px; border-radius: 5px; margin-bottom: 15px; display: flex; align-items: center; }
        .alert-success { background-color: rgba(46, 204, 113, 0.2); border: 1px solid var(--secondary); color: var(--secondary-dark); }
        .notification { position: fixed; top: 20px; right: 20px; z-index: 200; }
       
        .search-box { display: flex; margin-bottom: 20px; gap: 10px; flex-wrap: wrap; }
        .search-input { padding: 10px 15px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
        .search-btn { padding: 10px 15px; background-color: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; }
       
        .map-container { margin-top: 20px; border: 1px solid #ddd; border-radius: 5px; overflow: hidden; }
        canvas { width: 100%; height: 200px; }
       
        .auth-container { min-height: 100vh; display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); }
        .auth-box { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); width: 100%; max-width: 400px; }
        .auth-title { text-align: center; margin-bottom: 30px; font-size: 24px; color: var(--dark); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; color: var(--text); }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        .auth-btn { width: 100%; margin-top: 20px; }
        .auth-switch { text-align: center; margin-top: 20px; color: var(--text); }
        .auth-switch a { color: var(--primary); text-decoration: none; }
        .error-message {
            color: var(--danger);
            text-align: center;
            margin-bottom: 15px;
            display: none;
        }
        .main-wrapper { display: none; }
        .main-wrapper.active { display: block; }
       
        @media screen and (max-width: 768px) {
            header .container { flex-wrap: wrap; }
            nav { display: none; width: 100%; margin-top: 15px; }
            nav.active { display: block; }
            nav ul { flex-direction: column; }
            nav ul li { margin: 0; margin-bottom: 10px; }
            .mobile-menu-btn { display: block; }
            .main-content { grid-template-columns: 1fr; }
            .search-box { flex-direction: column; }
            .search-input { width: 100%; margin-bottom: 10px; }
        }
    </style>
</head>
<body>
    <div class="auth-container" id="loginPage">
        <div class="auth-box">
            <div class="auth-title"><i class="fas fa-sign-in-alt"></i> Login</div>
            <div class="error-message" id="loginError"></div>
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" placeholder="Enter your password" required>
            </div>
            <button class="btn btn-primary auth-btn" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
            <div class="auth-switch">Don't have an account? <a href="#" onclick="showRegister()">Register</a></div>
        </div>
    </div>

    Register Page
    <div class="auth-container" id="registerPage" style="display: none;">
        <div class="auth-box">
            <div class="auth-title"><i class="fas fa-user-plus"></i> Register</div>
            <div class="error-message" id="registerError"></div>
            <div class="form-group">
                <label for="registerName">Full Name</label>
                <input type="text" id="registerName" placeholder="Enter your full name" required>
            </div>
            <div class="form-group">
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
                <label for="registerPassword">Password</label>
                <input type="password" id="registerPassword" placeholder="Create a password" required>
            </div>
            <button class="btn btn-primary auth-btn" onclick="register()">
                <i class="fas fa-user-plus"></i> Register
            </button>
            <div class="auth-switch">Already have an account? <a href="#" onclick="showLogin()">Login</a></div>
        </div>
    </div>

    Main Content
    <div class="main-wrapper" id="mainContent">
        <header>
            <div class="container">
                <div class="logo"><i class="fas fa-parking"></i> Smart Parking System</div>
                <nav>
                    <ul>
                        <li><a href="#" onclick="showMainPage()"><i class="fas fa-home"></i> Home</a></li>
                        <li><a href="#" onclick="showBookings()"><i class="fas fa-history"></i> Bookings</a></li>
                        <li><a href="#" onclick="showProfile()"><i class="fas fa-user"></i> Profile</a></li>
                        <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                    </ul>
                </nav>
                <div class="user-info" id="userDisplay"><i class="fas fa-user"></i> <span id="userName">User</span></div>
                <div class="toggle-container">
                    <label class="toggle-label">Dark Mode</label>
                    <label class="switch">
                        <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                        <span class="slider"></span>
                    </label>
                </div>
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </header>

        Main Parking Page
        <div class="container" id="mainPage">
            <div class="main-content">
                <div class="parking-layout">
                    <div class="layout-header">
                        <div class="layout-title">
                            <i class="fas fa-map-marker-alt"></i>
                            <select id="locationSelect" onchange="changeLocation()">
                                <option value="zoneA">City Center Parking - Zone A</option>
                                <option value="zoneB">City Center Parking - Zone B</option>
                            </select>
                        </div>
                        <div class="parking-filters">
                            <div class="filter-item"><span class="legend-available"></span> Available</div>
                            <div class="filter-item"><span class="legend-occupied"></span> Occupied</div>
                            <div class="filter-item"><span class="legend-reserved"></span> Reserved</div>
                            <div class="filter-item"><span class="legend-selected"></span> Selected</div>
                            <div class="filter-item"><span class="legend-disabled"></span> Disabled</div>
                        </div>
                    </div>

                    <div class="search-box">
                        <input type="text" id="slotSearch" class="search-input" placeholder="Search by slot number (e.g., A1)">
                        <select id="slotTypeFilter" class="search-input">
                            <option value="all">All Types</option>
                            <option value="Compact">Compact</option>
                            <option value="Standard">Standard</option>
                            <option value="Large">Large</option>
                            <option value="Disabled">Disabled</option>
                        </select>
                        <button class="search-btn" onclick="filterSlots()">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                    </div>

                    <div class="parking-area" id="parkingArea"></div>
                    <div class="map-container">
                        <canvas id="parkingMap"></canvas>
                    </div>
                </div>

                <div class="booking-panel">
                    <div class="panel-title"><i class="fas fa-bookmark"></i> Book a Parking Slot</div>
                    <div id="slot-selection-prompt">
                        <p>Please select an available parking slot from the layout.</p>
                    </div>
                    <div id="booking-form" style="display: none;">
                        <div class="booking-details">
                            <div class="detail-item">
                                <div class="detail-label">Selected Slot</div>
                                <div class="detail-value" id="selected-slot">-</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Slot Type</div>
                                <div class="detail-value" id="slot-type">-</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Date</div>
                                <input type="date" class="detail-input" id="booking-date">
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Start Time</div>
                                <input type="time" class="detail-input" id="start-time">
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Duration (hours)</div>
                                <input type="number" class="detail-input" id="duration" min="1" max="24" value="1">
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Vehicle Details</div>
                                <input type="text" class="detail-input" id="vehicle-details" placeholder="License Plate">
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Estimated Price</div>
                                <div class="detail-value" id="estimated-price">$0.00</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Time Remaining to Book</div>
                                <div class="detail-value" id="reservation-timer">-</div>
                            </div>
                        </div>
                        <div class="booking-actions">
                            <button class="btn btn-primary" onclick="showPaymentModal()">
                                <i class="fas fa-credit-card"></i> Proceed to Payment
                            </button>
                            <button class="btn btn-secondary" onclick="clearSelection()">
                                <i class="fas fa-times-circle"></i> Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        Profile Page
        <div class="container" id="profilePage" style="display: none;">
            <div class="booking-panel">
                <div class="panel-title"><i class="fas fa-user"></i> Profile Management</div>
                <div class="form-group">
                    <label for="profileName">Full Name</label>
                    <input type="text" id="profileName" class="detail-input">
                </div>
                <div class="form-group">
                    <label for="profileEmail">Email</label>
                    <input type="email" id="profileEmail" class="detail-input" readonly>
                </div>
                <div class="form-group">
                    <label for="profilePassword">New Password</label>
                    <input type="password" id="profilePassword" class="detail-input" placeholder="Leave blank to keep current">
                </div>
                <div class="form-group">
                    <label for="profileVehicle">Default Vehicle</label>
                    <input type="text" id="profileVehicle" class="detail-input" placeholder="License Plate">
                </div>
                <button class="btn btn-primary" onclick="updateProfile()">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </div>

        Confirmation Modal
        <div class="modal" id="confirmationModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-check-circle"></i> Booking Confirmed</div>
                    <div class="modal-close" onclick="closeModal('confirmationModal')">Ã—</div>
                </div>
                <div class="modal-body">
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i> Your parking slot has been successfully booked!
                    </div>
                    <div class="booking-details">
                        <div class="detail-item"><div class="detail-label">Parking Slot</div><div class="detail-value" id="confirm-slot">-</div></div>
                        <div class="detail-item"><div class="detail-label">Date</div><div class="detail-value" id="confirm-date">-</div></div>
                        <div class="detail-item"><div class="detail-label">Time</div><div class="detail-value" id="confirm-time">-</div></div>
                        <div class="detail-item"><div class="detail-label">Duration</div><div class="detail-value" id="confirm-duration">-</div></div>
                        <div class="detail-item"><div class="detail-label">Vehicle</div><div class="detail-value" id="confirm-vehicle">-</div></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('confirmationModal')">Close</button>
                </div>
            </div>
        </div>

        Payment Modal
        <div class="modal" id="paymentModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-credit-card"></i> Payment</div>
                    <div class="modal-close" onclick="closeModal('paymentModal')">Ã—</div>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="cardNumber">Card Number</label>
                        <input type="text" id="cardNumber" class="detail-input" placeholder="1234 5678 9012 3456">
                    </div>
                    <div class="form-group">
                        <label for="cardExpiry">Expiry Date</label>
                        <input type="text" id="cardExpiry" class="detail-input" placeholder="MM/YY">
                    </div>
                    <div class="form-group">
                        <label for="cardCVC">CVC</label>
                        <input type="text" id="cardCVC" class="detail-input" placeholder="123">
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Total Amount</div>
                        <div class="detail-value" id="paymentAmount">$0.00</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="confirmBooking()">Pay Now</button>
                    <button class="btn btn-secondary" onclick="closeModal('paymentModal')">Cancel</button>
                </div>
            </div>
        </div>

        Bookings Modal
        <div class="modal" id="bookingsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-history"></i> My Bookings</div>
                    <div class="modal-close" onclick="closeModal('bookingsModal')">Ã—</div>
                </div>
                <div class="modal-body" id="bookingsList"></div>
            </div>
        </div>

        Notification Container
        <div class="notification" id="notificationContainer"></div>
    </div>

    <script>
        // Parking Locations Data
        const locations = {
            zoneA: [
                { row: 'A', slots: ['A1:Compact:available', 'A2:Compact:occupied', 'A3:Compact:available', 'A4:Compact:available', 'A5:Compact:occupied', 'A6:Compact:available'] },
                { row: 'B', slots: ['B1:Standard:reserved', 'B2:Standard:occupied', 'B3:Standard:available', 'B4:Standard:available', 'B5:Standard:occupied', 'B6:Standard:available'] },
                { row: 'C', slots: ['C1:Large:available', 'C2:Large:available', 'C3:Large:reserved', 'C4:Large:occupied', 'C5:Large:available', 'C6:Large:available'] },
                { row: 'D', slots: ['D1:Compact:occupied', 'D2:Compact:available', 'D3:Compact:available', 'D4:Compact:reserved', 'D5:Compact:occupied', 'D6:Disabled:available'] }
            ],
            zoneB: [
                { row: 'E', slots: ['E1:Compact:available', 'E2:Compact:occupied', 'E3:Standard:available', 'E4:Standard:reserved', 'E5:Large:available'] },
                { row: 'F', slots: ['F1:Large:occupied', 'F2:Large:available', 'F3:Disabled:available', 'F4:Compact:available', 'F5:Standard:occupied'] }
            ]
        };

        let selectedSlot = null;
        let reservationTimer = null;

        // Authentication
        function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const error = document.getElementById('registerError');

            if (!name || !email || !password) {
                error.style.display = 'block';
                error.textContent = 'Please fill in all fields';
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            if (users.some(user => user.email === email)) {
                error.style.display = 'block';
                error.textContent = 'Email already registered';
                return;
            }

            users.push({ name, email, password, vehicle: '' });
            localStorage.setItem('users', JSON.stringify(users));
            showLogin();
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const error = document.getElementById('loginError');

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.email === email && u.password === password);

            if (!user) {
                error.style.display = 'block';
                error.textContent = 'Invalid email or password';
                return;
            }

            localStorage.setItem('currentUser', JSON.stringify(user));
            showMainContent(user);
        }

        function logout() {
            localStorage.removeItem('currentUser');
            showLogin();
        }

        function showLogin() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('registerPage').style.display = 'none';
            document.getElementById('mainContent').classList.remove('active');
        }

        function showRegister() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('registerPage').style.display = 'flex';
            document.getElementById('mainContent').classList.remove('active');
        }

        function showMainContent(user) {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('registerPage').style.display = 'none';
            document.getElementById('mainContent').classList.add('active');
            document.getElementById('userName').textContent = user.name;
            showMainPage();
            document.getElementById('vehicle-details').value = user.vehicle || '';
        }

        // Page Navigation
        function showMainPage() {
            document.getElementById('mainPage').style.display = 'block';
            document.getElementById('profilePage').style.display = 'none';
            renderParkingArea();
        }

        function showProfile() {
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('profilePage').style.display = 'block';
            const user = JSON.parse(localStorage.getItem('currentUser'));
            document.getElementById('profileName').value = user.name;
            document.getElementById('profileEmail').value = user.email;
            document.getElementById('profileVehicle').value = user.vehicle || '';
        }

        function updateProfile() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            const newName = document.getElementById('profileName').value;
            const newPassword = document.getElementById('profilePassword').value;
            const newVehicle = document.getElementById('profileVehicle').value;

            user.name = newName;
            if (newPassword) user.password = newPassword;
            user.vehicle = newVehicle;

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.email === user.email);
            users[userIndex] = user;
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('currentUser', JSON.stringify(user));
            document.getElementById('userName').textContent = user.name;
            showNotification('Profile updated successfully!');
        }

        // Parking System
        window.onload = function() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser) showMainContent(currentUser);
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('booking-date').min = formattedDate;
            document.getElementById('booking-date').value = formattedDate;
            const darkMode = localStorage.getItem('darkMode') === 'true';
            document.getElementById('darkModeToggle').checked = darkMode;
            if (darkMode) document.body.classList.add('dark-mode');
            setInterval(updateRealTimeAvailability, 10000); // Every 10 seconds
        };

        function renderParkingArea() {
            const location = document.getElementById('locationSelect').value;
            const parkingArea = document.getElementById('parkingArea');
            parkingArea.innerHTML = `
                <div class="entrance" aria-label="Parking Entrance">
                    <i class="fas fa-door-open"></i> ENTRANCE
                </div>
            `;
            locations[location].forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'parking-row';
                rowDiv.innerHTML = `<div class="row-label">${row.row}</div>`;
                row.slots.forEach(slot => {
                    const [id, type, status] = slot.split(':');
                    const slotDiv = document.createElement('div');
                    slotDiv.className = `parking-slot ${status}`;
                    slotDiv.dataset.slot = id;
                    slotDiv.setAttribute('aria-label', `Parking slot ${id}, ${type}, ${status}`);
                    slotDiv.tabIndex = 0;
                    if (status === 'available') slotDiv.onclick = () => selectSlot(id);
                    slotDiv.innerHTML = `<span class="slot-type">${type}</span>${id}`;
                    rowDiv.appendChild(slotDiv);
                });
                parkingArea.appendChild(rowDiv);
            });
            updateAvailabilityCounter();
            drawMap(location);
        }

        function changeLocation() {
            clearSelection();
            renderParkingArea();
        }

        function selectSlot(slotId) {
            if (selectedSlot) document.querySelector(`[data-slot="${selectedSlot}"]`).classList.remove('selected');
            selectedSlot = slotId;
            document.querySelector(`[data-slot="${slotId}"]`).classList.add('selected');
            document.getElementById('slot-selection-prompt').style.display = 'none';
            document.getElementById('booking-form').style.display = 'block';
            document.getElementById('selected-slot').textContent = slotId;
            const slotTypeElement = document.querySelector(`[data-slot="${slotId}"] .slot-type`);
            const slotType = slotTypeElement ? slotTypeElement.textContent : 'Standard';
            document.getElementById('slot-type').textContent = slotType;
            calculatePrice();
            startReservationTimer();
        }

        function clearSelection() {
            if (selectedSlot) document.querySelector(`[data-slot="${selectedSlot}"]`).classList.remove('selected');
            selectedSlot = null;
            document.getElementById('booking-form').style.display = 'none';
            document.getElementById('slot-selection-prompt').style.display = 'block';
            clearInterval(reservationTimer);
            document.getElementById('reservation-timer').textContent = '-';
        }

        function startReservationTimer() {
            let timeLeft = 300; // 5 minutes in seconds
            clearInterval(reservationTimer);
            reservationTimer = setInterval(() => {
                if (timeLeft <= 0) {
                    clearSelection();
                    showNotification('Reservation time expired!');
                    return;
                }
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('reservation-timer').textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                timeLeft--;
            }, 1000);
        }

        function showPaymentModal() {
            const price = document.getElementById('estimated-price').textContent;
            document.getElementById('paymentAmount').textContent = price;
            document.getElementById('paymentModal').classList.add('active');
        }

        function confirmBooking() {
            const date = document.getElementById('booking-date').value;
            const startTime = document.getElementById('start-time').value;
            const duration = document.getElementById('duration').value;
            const vehicleDetails = document.getElementById('vehicle-details').value;
            const cardNumber = document.getElementById('cardNumber').value;

            if (!date || !startTime || !duration || !vehicleDetails || !cardNumber) {
                showNotification('Please fill in all fields including payment details!', 'warning');
                return;
            }

            document.getElementById('confirm-slot').textContent = selectedSlot;
            document.getElementById('confirm-date').textContent = formatDate(date);
            document.getElementById('confirm-time').textContent = formatTime(startTime);
            document.getElementById('confirm-duration').textContent = `${duration} hour${duration > 1 ? 's' : ''}`;
            document.getElementById('confirm-vehicle').textContent = vehicleDetails;

            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const booking = { slot: selectedSlot, date, startTime, duration, vehicle: vehicleDetails, timestamp: new Date().toISOString(), location: document.getElementById('locationSelect').value };
            const userBookings = JSON.parse(localStorage.getItem(`bookings_${currentUser.email}`) || '[]');
            userBookings.push(booking);
            localStorage.setItem(`bookings_${currentUser.email}`, JSON.stringify(userBookings));

            const location = document.getElementById('locationSelect').value;
            locations[location].forEach(row => {
                row.slots = row.slots.map(s => s.startsWith(selectedSlot) ? `${selectedSlot}:${s.split(':')[1]}:reserved` : s);
            });

            document.getElementById('paymentModal').classList.remove('active');
            document.getElementById('confirmationModal').classList.add('active');
            showNotification('Booking confirmed successfully!');
            clearSelection();
            renderParkingArea();
        }

        function showBookings() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const bookings = JSON.parse(localStorage.getItem(`bookings_${currentUser.email}`) || '[]');
            const bookingsList = document.getElementById('bookingsList');
            bookingsList.innerHTML = bookings.length ? bookings.map((b, i) => `
                <div class="booking-details">
                    <div class="detail-item"><div class="detail-label">Slot</div><div class="detail-value">${b.slot}</div></div>
                    <div class="detail-item"><div class="detail-label">Date</div><div class="detail-value">${formatDate(b.date)}</div></div>
                    <div class="detail-item"><div class="detail-label">Time</div><div class="detail-value">${formatTime(b.startTime)}</div></div>
                    <div class="detail-item"><div class="detail-label">Duration</div><div class="detail-value">${b.duration} hour${b.duration > 1 ? 's' : ''}</div></div>
                    <button class="btn btn-primary" onclick="extendBooking(${i})">Extend</button>
                </div>
            `).join('') : '<p>No bookings found.</p>';
            document.getElementById('bookingsModal').classList.add('active');
        }

        function extendBooking(index) {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const bookings = JSON.parse(localStorage.getItem(`bookings_${currentUser.email}`) || '[]');
            const booking = bookings[index];
            const newDuration = prompt('Enter additional hours to extend:', 1);
            if (newDuration && !isNaN(newDuration)) {
                booking.duration = parseInt(booking.duration) + parseInt(newDuration);
                localStorage.setItem(`bookings_${currentUser.email}`, JSON.stringify(bookings));
                showBookings();
                showNotification(`Booking for ${booking.slot} extended by ${newDuration} hour${newDuration > 1 ? 's' : ''}!`);
            }
        }

        function updateRealTimeAvailability() {
            const location = document.getElementById('locationSelect').value;
            locations[location].forEach(row => {
                row.slots = row.slots.map(slot => {
                    if (Math.random() < 0.1 && !slot.includes('reserved')) { // 10% chance to change status
                        const [id, type] = slot.split(':');
                        const newStatus = Math.random() < 0.5 ? 'available' : 'occupied';
                        return `${id}:${type}:${newStatus}`;
                    }
                    return slot;
                });
            });
            if (!selectedSlot) renderParkingArea();
        }

        function updateAvailabilityCounter() {
            const totalSlots = document.querySelectorAll('.parking-slot').length;
            const availableSlots = document.querySelectorAll('.parking-slot.available').length;
            let counter = document.getElementById('availability-counter');
            if (!counter) {
                counter = document.createElement('div');
                counter.id = 'availability-counter';
                counter.className = 'alert alert-info';
                counter.innerHTML = '<i class="fas fa-info-circle"></i> <span id="available-count"></span>';
                const parkingArea = document.getElementById('parkingArea');
                parkingArea.parentNode.insertBefore(counter, parkingArea);
            }
            document.getElementById('available-count').textContent = `${availableSlots} out of ${totalSlots} parking slots available`;
        }

        function filterSlots() {
            const searchValue = document.getElementById('slotSearch').value.toUpperCase();
            const filterValue = document.getElementById('slotTypeFilter').value;
            const allSlots = document.querySelectorAll('.parking-slot');
            allSlots.forEach(slot => {
                const slotId = slot.dataset.slot;
                const slotType = slot.querySelector('.slot-type').textContent;
                const matchesSearch = !searchValue || slotId.includes(searchValue);
                const matchesType = filterValue === 'all' || slotType === filterValue;
                slot.style.opacity = matchesSearch && matchesType ? '1' : '0.3';
            });
        }

        function calculatePrice() {
            const duration = parseInt(document.getElementById('duration').value) || 0;
            const slotType = document.getElementById('slot-type').textContent;
            const rates = { 'Compact': 2, 'Standard': 3, 'Large': 4, 'Disabled': 2.5 };
            const rate = rates[slotType] || 2;
            const price = duration * rate;
            document.getElementById('estimated-price').textContent = `$${price.toFixed(2)}`;
        }

        function drawMap(location) {
            const canvas = document.getElementById('parkingMap');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = 200;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#ddd';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const rows = locations[location].length;
            const slotsPerRow = locations[location][0].slots.length;
            const slotWidth = canvas.width / (slotsPerRow + 1);
            const slotHeight = canvas.height / (rows + 1);

            locations[location].forEach((row, rowIndex) => {
                row.slots.forEach((slot, slotIndex) => {
                    const [id, type, status] = slot.split(':');
                    ctx.fillStyle = status === 'available' ? '#2ecc71' : status === 'occupied' ? '#e74c3c' : status === 'reserved' ? '#f39c12' : '#95a5a6';
                    if (selectedSlot === id) ctx.fillStyle = '#3498db';
                    ctx.fillRect(slotIndex * slotWidth + slotWidth / 2, rowIndex * slotHeight + slotHeight / 2, slotWidth - 10, slotHeight - 10);
                    ctx.fillStyle = '#fff';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(id, slotIndex * slotWidth + slotWidth, rowIndex * slotHeight + slotHeight);
                });
            });
        }

        function toggleMobileMenu() {
            document.querySelector('nav').classList.toggle('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notif = document.createElement('div');
            notif.className = `alert alert-${type}`;
            notif.innerHTML = `<i class="fas fa-bell"></i> ${message}`;
            container.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        function toggleDarkMode() {
            const isDark = document.getElementById('darkModeToggle').checked;
            document.body.classList.toggle('dark-mode', isDark);
            localStorage.setItem('darkMode', isDark);
        }

        function formatDate(dateString) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        function formatTime(timeString) {
            if (!timeString) return '-';
            const [hours, minutes] = timeString.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            return `${hour12}:${minutes} ${ampm}`;
        }

        document.getElementById('duration').addEventListener('input', calculatePrice);
        document.getElementById('slotSearch').addEventListener('input', filterSlots);
    </script>
</body>
</html>
